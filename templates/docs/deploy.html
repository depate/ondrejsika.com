{% extends "docs/base.html" %}

{% set title = "deploy documentation" %}
{% set authors = [
    ["Ondrej Sika", "ondrejsika.com", "dev@ondrejsika.com"],
] %}
{% set sources = [
    ["Documentation", "ondrejsika.com/docs/deploy"],
    ["GitHub", "github.com/sikaondrej/deploy"],
] %}

{% block content2 %}
<p>Easy deploy Python WSGI apps</p>
{% endblock content2 %}


{% block content3 %}
<h3>Table of content</h3>
<!-- max id 13 -->
<ul>
    <li><a href="#x1">Installation</a>
        <ul>
            <li><a href="#x2">Depencies</a></li>
            <li><a href="#x3">PIP instalation</a></li>
        </ul>
    </li>
    <li><a href="#x4">Create server</a></li>
    <li><a href="#x10">Application structure</a>
        <ul>
            <li><a href="#x11">wsgi</a></li>
            <li><a href="#x12">pip requiements</a></li>
            <li><a href="#x13">post update</a></li>
        </ul>
    </li>
    <li><a href="#x5">Update via GIT</a></li>
    <li><a href="#x6">Edit server conf</a>
        <ul>
            <li><a href="#x8">nginx</a></li>
            <li><a href="#x9">supervisor</a></li>
        </ul>
    </li>
    <li><a href="#x7">Restar server</a></li>
</ul>

<h3 id="x1">Installation</h3>
<h4 id="x2">Depencies</h4>
Need installed before install deploy
<pre>
nginx
gunicorn
supervisor
git
sudo
</pre>
<h4 id="x3">PIP installation</h4>
as root
<pre>
pip install deploy
deploy-init
</pre>

<h3 id="x4">Create server</h3>
<pre>
deploy startserver appname "domain.com www.domain.com"
</pre>

<h3 id="x10">Application structure</h3>
<h4 id="x11">wsgi</h4>
in project root must be file <b>wsgi.py</b> with variable application (wsgi application)

<h4 id="x12">pip requirements</h4>
if existst file <b>requirements.txt</b> in project root, auto install requirements to virtualenv in <b>env</b> dir

<h4 id="x13">post_update</h4>
<b>post_update</b> is executable file in app root, launched after git update. can be used for db migrations, etc.


<h3 id="x5">Update via GIT</h3>
in production is branch master
<pre>
git clone git@server:appname.git
cd appname
# ... some changes and commits ...
git push origin master
</pre>

<h3 id="x6">Edit server conf</h3>
opens vim with config file, then restart service
<h4 id="x8">nginx</h4>
<pre>
deploy serverconf "appname" nginx
</pre>

<h4 id="x9">supervisor</h4>
<pre>
deploy serverconf "appname" supervisor
</pre>

<h3 id="x7">Restart server</h3>
restart only worker (supervisor), not nginx
<pre>
deploy restart "appname"
</pre>

{% endblock content3 %}